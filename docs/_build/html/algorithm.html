<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Algorithm &mdash; dendromatics 00.00.01 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Functions" href="dendromatics.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            dendromatics
              <img src="_static/dendromatics_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Algorithm</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#height-normalization-of-the-point-cloud-pre-requisite">0. Height-normalization of the point cloud (pre-requisite)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#identification-of-stems-among-user-provided-horizontal-stripe">1. Identification of stems among user-provided horizontal stripe</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tree-individualization-based-on-point-to-stems-distances">2. Tree individualization based on point-to-stems distances</a></li>
<li class="toctree-l2"><a class="reference internal" href="#computation-of-stem-diameter-at-different-section-heights">3. Computation of stem diameter at different section heights</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dendromatics.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="executable.html">3DFIN</a></li>
<li class="toctree-l1"><a class="reference internal" href="cc_plugin.html">CloudCompare plugin</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">dendromatics</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Algorithm</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/algorithm.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="algorithm">
<h1>Algorithm<a class="headerlink" href="#algorithm" title="Permalink to this heading"></a></h1>
<p>The package functionalities are based on an updated version of the algorithm presented in <a class="reference internal" href="index.html#cabo2018" id="id1"><span>[CABO2018]</span></a>. What follows is a description of the main steps of the algorithm.</p>
<section id="height-normalization-of-the-point-cloud-pre-requisite">
<h2>0. Height-normalization of the point cloud (pre-requisite)<a class="headerlink" href="#height-normalization-of-the-point-cloud-pre-requisite" title="Permalink to this heading"></a></h2>
<p>The algorithm requires a height-normalized point cloud as input, as in Figure 1.</p>
<a class="reference internal image-reference" href="_images/height-normalization.jpg"><img alt="_images/height-normalization.jpg" class="align-center" src="_images/height-normalization.jpg" style="width: 670px;" /></a>
<p><em>Figure 1. The algorithm requires height-normalized point clouds. A) Original point cloud. B) Height-normalized point cloud. From</em> <a class="reference internal" href="index.html#cabo2018" id="id2"><span>[CABO2018]</span></a>.</p>
<p>To achieve this, a digital terrain model (DTM) is generated and the normalized heights for each point in the cloud are obtained as the difference between their (z) value and the (z) value of the DTM points that are below.</p>
<p>To generate the DTM itself, a cloth-simulation filter (CSF) as described in <a class="reference internal" href="index.html#zhan2016" id="id3"><span>[ZHAN2016]</span></a> is applied to the point cloud. To obtain the DTM points that are below a certain cloud point, a cKDtree is generated and the 3 closest DTM points are identified. Then, a weighted average of the (z) value based on the distance to the cloud point is obtained, and the normalized height value is computed as the difference between the (z) value of the cloud point and the weighted average (z) value of the DTM points.</p>
</section>
<section id="identification-of-stems-among-user-provided-horizontal-stripe">
<h2>1. Identification of stems among user-provided horizontal stripe<a class="headerlink" href="#identification-of-stems-among-user-provided-horizontal-stripe" title="Permalink to this heading"></a></h2>
<p>In this first step, the user selects a stripe, defined this as a subset of the original cloud delimited by a lower height (<span class="math notranslate nohighlight">\(Z_{h(low)}\)</span>) and an upper height (<span class="math notranslate nohighlight">\(Z_{h(high)}\)</span>), which will narrow down a region where it is expected to only encounter stems. The points within the stripe will be voxelated and their verticality will be computed, based on fixed radius neighbourhoods. Then, they will be filtered based on their verticality value. After this, the remaining points will be clustered using the DBSCAN algorithm (<a class="reference internal" href="index.html#este2018" id="id4"><span>[ESTE2018]</span></a>). These procedures will be repeated iteratively a user-defined number of times. At this stage, the potential stems are referred as ‘voxel groups’. Figure 2 illustrates this step of the algorithm.</p>
<a class="reference internal image-reference" href="_images/stripe_and_groups.jpg"><img alt="_images/stripe_and_groups.jpg" class="align-center" src="_images/stripe_and_groups.jpg" style="width: 700px;" /></a>
<p><em>Figure 2. Stripe on the height-normalized point cloud, and candidate voxel groups. Points in the stripe in red, and voxel groups in random colours. From</em> <a class="reference internal" href="index.html#cabo2018" id="id5"><span>[CABO2018]</span></a>.</p>
</section>
<section id="tree-individualization-based-on-point-to-stems-distances">
<h2>2. Tree individualization based on point-to-stems distances<a class="headerlink" href="#tree-individualization-based-on-point-to-stems-distances" title="Permalink to this heading"></a></h2>
<p>Once the voxel groups have been computed and properly peeled-off, they are isolated and enumerated, and then, their axes are identified using PCA (PCA1 direction). These axes will be henceforth considered as stem axes. This allows to group points based on their distance to those axes, thus assigning each point to a tree. This is illustrated in Figure 3.</p>
<a class="reference internal image-reference" href="_images/individualized_trees.jpg"><img alt="_images/individualized_trees.jpg" class="align-center" src="_images/individualized_trees.jpg" style="width: 620px;" /></a>
<p><em>Figure 3. Isolated trees. Note that ground and understory points are assigned as well to the closest axis. From</em> <a class="reference internal" href="index.html#cabo2018" id="id6"><span>[CABO2018]</span></a>.</p>
<p>During this step of the algorithm the tree height is computed as well. For this, and, for each tree, the points that are under a certain distance to the stem axis are selected, voxelated again using a higher resolution and clustered with DBSCAN algorithm. From the points that belong to the main cluster (the one that englobes the tree), the highest point is selected, and its height is considered as the tree height. This allows to exclude from the search of the highest point those that could belong to other trees or any noise that happened to be above the tree whilst being scanned. Figure 4 illustrates this.</p>
<a class="reference internal image-reference" href="_images/tree_height.jpg"><img alt="_images/tree_height.jpg" class="align-center" src="_images/tree_height.jpg" style="width: 200px;" /></a>
<p><em>Figure 4. Total tree height (TH) computation. Note that it avoids isolated point clusters that may not belong to the tree. From</em> <a class="reference internal" href="index.html#cabo2018" id="id7"><span>[CABO2018]</span></a>.</p>
</section>
<section id="computation-of-stem-diameter-at-different-section-heights">
<h2>3. Computation of stem diameter at different section heights<a class="headerlink" href="#computation-of-stem-diameter-at-different-section-heights" title="Permalink to this heading"></a></h2>
<p>In this final step a set of heights is defined, which will then be used to measure the stem diameter at different sections around the tree axes. To do so, a slice of points will be selected at every section, and those will be fit a circle by least squares minimization. This procedure is similar as the one proposed in <a class="reference internal" href="index.html#pren2021" id="id8"><span>[PREN2021]</span></a>.</p>
<p>To ensure robustness, the goodness of fit is checked. What follows is a brief list of all the <strong>tests</strong> that are performed:</p>
<ul class="simple">
<li><p>Number of points inside the circle. This is checked via fitting an <strong>inner circle</strong></p></li>
<li><p>Percentage of <strong>occupied sectors</strong></p></li>
<li><p>Size of fitted circle (if it is <strong>radius is too small/big</strong>)</p></li>
<li><p><strong>Vertical deviation from tree axis</strong> (‘outlier probability’)</p></li>
</ul>
<p>First, a complementary, inner circle is fitted as well, which will be used to check how points are distributed inside the first circle: they are expected to be outside the inner circle, as the scanning should only scan the surface of the stems. Second, the section is divided in several sectors to check if there are points within them (so they are occupied). If there are not enough occupied sectors, the section fails the test, as it is safe to assume it has an abnormal, non-desirable structure. After this, it is checked whether the diameter of the fitted circle is within some boundaries, to discard anomalies. Finally, the vertical deviation from the tree axis is computed for every section and it is used to check possible bad fittings: highly deviated sections are labelled as possible outliers.</p>
<p>On top of all goodness of fit tests, there is a last layer or robustness while computing the diameters. If the first fit is not appropriate, another circle will be fitted to substitute it using only points from the largest cluster in the slice of points, and the goodness of fit will be tested again. Figure 5 illustrates an example of some fitted circles after all tests and their respective axes.</p>
<a class="reference internal image-reference" href="_images/sections_and_axes.jpg"><img alt="_images/sections_and_axes.jpg" class="align-center" src="_images/sections_and_axes.jpg" style="width: 680px;" /></a>
<p><em>Figure 5. Fitted circles in 6 stems, at sections ranging from 0.3 to a maximum of 25.0 meters, one every 0.2 meters. Blue circles passed all quality tests, while red circles mean the fitting may be unreliable. This may be due to partial scans, non-expected diameter measurements, non-reasonable distribution of points within the section or a high value of tilting. Computed axes are represented at the right.</em></p>
<p>During this step, besides computing all the diameters at the selected heights, the DBH will be approximated as well (even if BH was not included as one of the selected heights). For this, the section closest to 1.3 m will be used as a proxy, and the DBH will only be computed if there is coherence between that section and the ones around.</p>
<p>Tree location [(x, y) coordinates] is obtained at this step too, either derived from the proxy section (to BH) when appropriate; that is, when it passes all goodness of fit tests and it is coherent, or from the tree axis when not.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dendromatics.html" class="btn btn-neutral float-right" title="Functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Carlos Cabo &amp; Diego Laino.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>